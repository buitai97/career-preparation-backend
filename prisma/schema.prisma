// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "mongodb"
}

enum ResumeSectionType {
    EDUCATION
    EXPERIENCE
    SKILLS
    PROJECT
    OTHER
}

enum SessionStatus {
    IN_PROGRESS
    COMPLETED
}

model User {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    name      String
    email     String   @unique
    password  String
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    resumes  Resume[]
    sessions InterviewSession[]
}

model Resume {
    id             String          @id @default(auto()) @map("_id") @db.ObjectId
    userId         String          @db.ObjectId
    title          String
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @default(now()) @updatedAt
    resumeSections ResumeSection[]

    user              User               @relation(fields: [userId], references: [id])
    interviewSessions InterviewSession[]

    @@index([userId])
}

model ResumeSection {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    resumeId  String   @db.ObjectId
    order     Int
    type      ResumeSectionType
    content   Json
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    resume Resume @relation(fields: [resumeId], references: [id])

    @@index([resumeId])
    @@index([resumeId, order])
}

model InterviewSession {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    userId    String   @db.ObjectId
    role      String
    status    SessionStatus @default(IN_PROGRESS)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    completedAt DateTime?
    overallScore Float?
    resumeId  String? @db.ObjectId

    resume    Resume?             @relation(fields: [resumeId], references: [id])
    questions InterviewQuestion[]
    user      User                @relation(fields: [userId], references: [id])

    @@index([userId])
    @@index([resumeId])
}

model InterviewQuestion {
    id        String @id @default(auto()) @map("_id") @db.ObjectId
    sessionId String @db.ObjectId
    question  String

    answers InterviewAnswer[]
    session InterviewSession  @relation(fields: [sessionId], references: [id])

    @@index([sessionId])
}

model InterviewAnswer {
    id         String @id @default(auto()) @map("_id") @db.ObjectId
    questionId String @db.ObjectId
    answer     String

    question InterviewQuestion @relation(fields: [questionId], references: [id])
    feedback AnswerFeedback?

    @@index([questionId])
}

model AnswerFeedback {
    id           String @id @default(auto()) @map("_id") @db.ObjectId
    answerId     String @unique @db.ObjectId
    score        Float
    strengths    String
    improvements String
    createdAt     DateTime @default(now())

    answer InterviewAnswer @relation(fields: [answerId], references: [id])

}
