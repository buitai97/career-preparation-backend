generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
    id        String   @id @default(uuid())
    name      String
    email     String   @unique
    password  String
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    resumes  Resume[]
    sessions InterviewSession[]
}

model Resume {
    id             String          @id @default(uuid())
    userId         String
    title          String
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @default(now()) @updatedAt
    resumeSections ResumeSection[]

    user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
    interviewSessions InterviewSession[]

  @@index([userId])
}

model ResumeSection {
    id        String   @id @default(uuid())
    resumeId  String
    order     Int
    type      ResumeSectionType
    content   Json
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    resume Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  @@index([resumeId])
  @@index([resumeId, order])
}

model InterviewSession {
    id        String   @id @default(uuid())
    userId    String
    role      String
    status    SessionStatus @default(IN_PROGRESS)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    completedAt DateTime?
    overallScore Float?
    resumeId  String?

    resume    Resume?             @relation(fields: [resumeId], references: [id], onDelete: SetNull)
    questions InterviewQuestion[]
    user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([resumeId])
}

model InterviewQuestion {
    id        String @id @default(uuid())
    sessionId String
    question  String

    answers InterviewAnswer[]
    session InterviewSession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model InterviewAnswer {
    id         String @id @default(uuid())
    questionId String
    answer     String

    question InterviewQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
    feedback AnswerFeedback?

  @@index([questionId])
}

model AnswerFeedback {
    id           String @id @default(uuid())
    answerId     String @unique
    score        Float
    strengths    String
    improvements String
    createdAt     DateTime @default(now())

    answer InterviewAnswer @relation(fields: [answerId], references: [id], onDelete: Cascade)

    @@index([answerId])
}

enum ResumeSectionType {
  EDUCATION
  EXPERIENCE
  SKILLS
  PROJECT
  OTHER
}

enum SessionStatus {
  IN_PROGRESS
  COMPLETED
}
